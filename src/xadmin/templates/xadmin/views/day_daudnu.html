{% extends 'xadmin/base_site.html' %}
{% load i18n xadmin_tags %}
{% block content-nav %}
    <div class="navbar content-navbar navbar-default navbar-xs" data-toggle="breakpoint"
         data-class-xs="navbar content-navbar navbar-inverse navbar-xs"
         data-class-sm="navbar content-navbar navbar-default navbar-xs" style="margin-bottom: 10px;">
        <div class="btn-group  pull-right" role="group" aria-label="Large button group">
            <button type="button" class="btn btn-">表格</button>
            <button type="button" class="btn btn-info">图表</button>
        </div>
        <div class="navbar-header">
            <a class="navbar-brand" data-toggle="collapse" data-target="#top-nav .navbar-collapse">
                当日新增日活
            </a>
        </div>
        <form id="xadmin-form" style="margin-top: 8px;">
            <ul class="nav navbar-nav " style="margin-right: 10px;">
                <select class="form-control" id="pkg-select">
                    {% for i in pkg %}
                        <option value="{{ i.pkg }}">{{ i.name }}</option>
                    {% endfor %}

                </select>
            </ul>
            <button type="button" class="btn btn-info" id="submit-form">Submit</button>
        </form>

    </div>
{% endblock %}

{% block content %}
    <!-- 为 ECharts 准备一个具备大小（宽高）的 DOM -->

    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title">
                <div class="btn-group" role="group" aria-label="switch">
                    <button type="button" class="btn btn-default" onclick="switchpanl(this)" id="dnu-btn">新增</button>
                    <button type="button" class="btn btn-default" onclick="switchpanl(this)" id="dau-btn">日活</button>
                </div>
            </h3>
        </div>
        <div class="panel-body" id="panel-dnu">
            <div class="bs-example" data-example-id="condensed-table">
                <ul id="myTab" class="nav nav-tabs bar_tabs" role="tablist">
                    <li role="presentation" class="active"><a href="#u-ctr" id="u-ctr-tab" role="tab" data-toggle="tab"
                                                              aria-expanded="true">User国家</a>
                    </li>
                    <li role="presentation" class=""><a href="#ip-ctr" role="tab" id="ip-ctr-tab" data-toggle="tab"
                                                        aria-expanded="false">IP国家</a>
                    </li>

                    <li role="presentation" class=""><a href="#app-ver" id="app-ver-tab" role="tab" data-toggle="tab"
                                                        aria-expanded="false">版本</a>
                    </li>

                    <li role="presentation" class=""><a href="#p-u-ctr" id="p-u-ctr-tab" role="tab" data-toggle="tab"
                                                        aria-expanded="false">会员User国家</a>
                    </li>
                    <li role="presentation" class=""><a href="#p-ip-ctr" role="tab" id="p-ip-ctr-tab"
                                                        data-toggle="tab"
                                                        aria-expanded="false">会员IP国家</a>
                    </li>
                    <li role="presentation" class=""><a href="#p-app-ver" id="p-app-ver-tab" role="tab"
                                                        data-toggle="tab"
                                                        aria-expanded="false">会员版本</a>
                    </li>


                </ul>
                <div id="DAUTabContent" class="tab-content">

                    <div role="tabpanel" class="tab-pane fade active in" id="u-ctr" aria-labelledby="profile-tab">
                        <table id="u_ctr_table" class="table table-striped table-bordered  dt-responsive nowrap"
                               cellspacing="0" width="100%">
                            <thead>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>



                    <div role="tabpanel" class="tab-pane fade" id="ip-ctr" aria-labelledby="home-tab">
                        <table id="ip_ctr_table" class="table table-striped table-bordered  dt-responsive nowrap"
                               cellspacing="0" width="100%">
                            <thead>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>

                    <div role="tabpanel" class="tab-pane fade" id="p-ip-ctr" aria-labelledby="profile-tab">
                        <table id="p_ip_ctr_table" class="table table-striped table-bordered  dt-responsive nowrap"
                               cellspacing="0" width="100%">
                            <thead>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>

                    <div role="tabpanel" class="tab-pane fade active in" id="p-u-ctr" aria-labelledby="profile-tab">
                        <table id="p_u_ctr_table" class="table table-striped table-bordered  dt-responsive nowrap"
                               cellspacing="0" width="100%">
                            <thead>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>

                    <div role="tabpanel" class="tab-pane fade" id="app-ver" aria-labelledby="profile-tab">
                        <table id="app_ver_table" class="table table-striped table-bordered  dt-responsive nowrap"
                               cellspacing="0" width="100%">
                            <thead>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>

                    <div role="tabpanel" class="tab-pane fade" id="p-app-ver" aria-labelledby="home-tab">
                        <table id="p_app_ver_table" class="table table-striped table-bordered  dt-responsive nowrap"
                               cellspacing="0" width="100%">
                            <thead>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="panel-body hidden" id="panel-dau">
            <div class="bs-example" data-example-id="condensed-table">
                <ul id="myTab" class="nav nav-tabs bar_tabs" role="tablist">
                    <li role="presentation" class="active"><a href="#dau-u-ctr" id="u-ctr-tab" role="tab"
                                                              data-toggle="tab"
                                                              aria-expanded="true">User国家</a>
                    </li>

                    <li role="presentation" class=""><a href="#dau-app-ver" id="app-ver-tab" role="tab"
                                                        data-toggle="tab"
                                                        aria-expanded="false">版本</a>
                    </li>

                    <li role="presentation" class=""><a href="#dau-p-u-ctr" id="p-u-ctr-tab" role="tab"
                                                        data-toggle="tab"
                                                        aria-expanded="false">会员User国家</a>
                    </li>

                    <li role="presentation" class=""><a href="#dau-p-app-ver" id="p-app-ver-tab" role="tab"
                                                        data-toggle="tab"
                                                        aria-expanded="false">会员版本</a>
                    </li>


                </ul>
                <div id="DAUTabContent" class="tab-content">

                    <div role="tabpanel" class="tab-pane fade active in" id="dau-u-ctr" aria-labelledby="home-tab">
                        <table id="dau_u_ctr_table" class="table table-striped table-bordered  dt-responsive nowrap"
                               cellspacing="0" width="100%">
                            <thead>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>

                    <div role="tabpanel" class="tab-pane fade " id="dau-p-u-ctr" aria-labelledby="home-tab">
                        <table id="dau_p_u_ctr_table" class="table table-striped table-bordered  dt-responsive nowrap"
                               cellspacing="0" width="100%">
                            <thead>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>


                    <div role="tabpanel" class="tab-pane fade" id="dau-app-ver" aria-labelledby="home-tab">
                        <table id="dau_app_ver_table" class="table table-striped table-bordered  dt-responsive nowrap"
                               cellspacing="0" width="100%">
                            <thead>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>

                    <div role="tabpanel" class="tab-pane fade" id="dau-p-app-ver" aria-labelledby="home-tab">
                        <table id="dau_p_app_ver_table" class="table table-striped table-bordered  dt-responsive nowrap"
                               cellspacing="0" width="100%">
                            <thead>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>





{% endblock %}


{% block extrabody %}
    <script type="text/javascript">

        function switchpanl(obj) {
            $(obj).addClass('btn-success');
            if ($(obj).attr('id') === 'dnu-btn') {
                $('#dau-btn').removeClass('btn-success')
                $('#panel-dnu').removeClass('hidden')
                $('#panel-dau').addClass('hidden')

            }
            ;
            if ($(obj).attr('id') === 'dau-btn') {
                $('#dnu-btn').removeClass('btn-success')

                $('#panel-dau').removeClass('hidden')
                $('#panel-dnu').addClass('hidden')
            }
            ;
        }

        //检索相关数据,提交
        $('#submit-form').click(function () {
            $(this).addClass('disabled');
            $(this).text('Loading....');

            var pkg = $('#pkg-select').val()
            $.ajax({
                url: './',
                contentType: "application/json;charset=utf-8",
                type: "post",
                dataType: "json",
                data: JSON.stringify({'pkg': pkg}),
                beforeSend: function (xhr, settings) {
                    xhr.setRequestHeader("X-CSRFToken", $.getCookie('csrftoken'))
                },
                success: function (data) {
                    if (data.code === 0) {

                        setTable("ip_ctr_table", JSON.parse(data.result.dnu.ip_c.a), [{'title': 'ip国家'}, {'title': '总计'}]);
                        setTable("app_ver_table", JSON.parse(data.result.dnu.ver.a), [{'title': '版本'}, {'title': '总计'}]);
                        setTable("p_ip_ctr_table", JSON.parse(data.result.dnu.ip_c.p), [{'title': 'ip国家'}, {'title': '总计'}]);
                        setTable("p_app_ver_table", JSON.parse(data.result.dnu.ver.p), [{'title': '版本'}, {'title': '总计'}]);
                        setTable("p_u_ctr_table", JSON.parse(data.result.dnu.u_c.p), [{'title': 'user国家'}, {'title': '总计'}]);
                        setTable("u_ctr_table", JSON.parse(data.result.dnu.u_c.a), [{'title': 'user国家'}, {'title': '总计'}]);

                        setTable("dau_p_u_ctr_table", JSON.parse(data.result.dau.u_c.p), [{'title': 'user国家'}, {'title': '总计'}]);
                        setTable("dau_p_app_ver_table", JSON.parse(data.result.dau.ver.p), [{'title': '版本'}, {'title': '总计'}]);
                        setTable("dau_u_ctr_table", JSON.parse(data.result.dau.u_c.a), [{'title': 'user国家'}, {'title': '总计'}]);
                        setTable("dau_app_ver_table", JSON.parse(data.result.dau.ver.a), [{'title': '版本'}, {'title': '总计'}]);


                    }
                    $('#submit-form').removeClass('disabled')
                    $('#submit-form').text('Submit')
                    $('#dnu-btn').addClass('btn-success');
                    $('#dau-btn').removeClass('btn-success');
                    $('#panel-dnu').removeClass('hidden')
                    $('#panel-dau').addClass('hidden')

                }
            });


        });

        function setTable(id_table, data, columns) {
            var tbl_options = {
                destroy: true,
                "stateLoaded": function (settings, data) {
                    console.log('stateLoaded')
                    var hide_clm_ids = [];
                    $.each(data.columns, function (idx, clm) {
                        if (!clm.visible)
                            hide_clm_ids.push(idx)
                    });
                    $('#select_hide_column').multiselect('select', hide_clm_ids);
                },
                "pageLength": 25,
                "order": [],
                dom: "Blfrtip",
                buttons: [
                    {
                        extend: "copy",
                        className: "btn-sm"
                    },
                    {
                        extend: "csv",
                        className: "btn-sm"
                    },

                ],
                responsive: true
            }
            tbl_options.data = data;
            tbl_options.columns = columns;
            var var_table = $('#' + id_table).DataTable(tbl_options);
            return var_table
        }
    </script>


    <script type="text/javascript" src="/static/xadmin/vendor/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
    <script src="/static/xadmin/dist/echarts.min.js"></script>
    <script type="text/javascript" charset="utf8"
            src="/static/xadmin/vendor/DataTables-1.10.20/js/jquery.dataTables.js"></script>
{% endblock %}

{% block extrahead %}
    <link href="/static/xadmin/vendor/bootstrap-datepicker/css/datepicker.css" type="text/css" media="screen"
          rel="stylesheet">
    <link href="/static/xadmin/css/xadmin.main.css" type="text/css" media="screen" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/static/xadmin/vendor/DataTables-1.10.20/css/jquery.dataTables.css">
{% endblock %}



