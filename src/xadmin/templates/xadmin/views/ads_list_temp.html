{% extends 'xadmin/base_site.html' %}
{% load i18n xadmin_tags %}
{% block content-nav %}
    <style>
            .dataTables_length {
                width: 40%;
                float: left;
            }

            .panel-group .panel {
                margin-bottom: 0;
                overflow: unset;
                border-radius: 4px;
            }

            .input-group .form-control {
                padding-left: 1px;
                padding-right: 1px;
            }


        </style>
     <div class="navbar content-navbar navbar-default navbar-xs" data-toggle="breakpoint"
         data-class-xs="navbar content-navbar navbar-inverse navbar-xs"
         data-class-sm="navbar content-navbar navbar-default navbar-xs" style="margin-bottom: 10px;">
        <ul class="nav navbar-nav " style="margin: 11px;" id="country-select-ul">
            <select class="selectpicker form-control " title="请选择国家" data-live-search="true"
                    id="country-select">
                {% for k in ctr %}
                    <option value="{{ k.0 }}">{{ k.1 }}</option>
                {% endfor %}
            </select>
        </ul>
        <div class="input-group col-lg-2" style="margin: 11px">
            <span class="input-group-addon">最小版本</span>
            <input type="text" id="min_v" class="form-control" placeholder="min ver" value="0.0.0">
        </div>

        <div class="input-group col-lg-2" style="margin: 11px">
            <span class="input-group-addon">最大版本</span>
            <input type="text" id="max_v" class="form-control" placeholder="max ver" value="9.9.9">
        </div>

        <div class="input-group col-lg-1" style="margin: 11px;padding-top: 5px">
            <span class="">是否激活</span>
            <input type="checkbox" id="is_active" placeholder="is active">
        </div>

    </div>
    <div class="navbar content-navbar navbar-default navbar-xs" data-toggle="breakpoint"
         data-class-xs="navbar content-navbar navbar-inverse navbar-xs"
         data-class-sm="navbar content-navbar navbar-default navbar-xs" style="margin-bottom: 10px;">



        <div class="btn-group" role="group" aria-label="..." style="margin: 11px 0px">
            <button type="button" class="btn btn-info top_show_json"><i class="glyphicon glyphicon-book"></i> 显示总体json
            </button>
            <button type="button" class="btn btn-success top_add_ad_site"><i class="glyphicon glyphicon-plus"></i> 添加广告位
            </button>
            <button type="button" class="btn btn-primary save_json"><i class="glyphicon glyphicon-save"></i> save
            </button>
        </div>

        <div class="input-group col-lg-2" style="margin-top: 11px;padding-left: 0px">
            <span class="input-group-addon">all_show_times_limit</span>
            <input type="text" id="all_show_times_limit" class="form-control" placeholder="all_show_times_limit"
                 value="{{ ads_content.all_show_times_limit }}"  >
        </div>

        <div class="input-group col-lg-2" style="margin-top: 11px;padding-left: 0px">
            <span class="input-group-addon">all_click_times_limit</span>
            <input type="text" id="all_click_times_limit" class="form-control" placeholder="all_click_times_limit"
                 value="{{ ads_content.all_click_times_limit }}"   >
        </div>



    </div>

{% endblock %}


{% block content %}
    <!-- 为 ECharts 准备一个具备大小（宽高）的 DOM -->

    <div class="panel-group" id="accordion">

        {% csrf_token %}
        {% for k,v in  ads_content.content.items %}
            <div class="panel panel-default">
                <div class="panel-heading ads_site_panel">
                    <h4 class="panel-title">
                        <div class="input-group">
                            <span class="input-group-addon">广告位置</span>
                            <select name="ads_site_name" class="selectpicker " title="广告位" data-actions-box="true">
                                {% for i in ads_site %}
                                    {% if i == k %}
                                        <option selected value="{{ i }}">{{ i }}</option>
                                    {% else %}
                                        <option value="{{ i }}">{{ i }}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>

                            <button type="button" class="btn btn-success show_info" style="margin-left: 10px">编辑该广告
                            </button>
                            <button type="button" class="btn btn-danger del_ads" style="margin-left: 10px">删除该广告
                            </button>
                            <button type="button" class="btn btn-info show_ads_json" style="margin-left: 10px">
                                显示该广告位位置json
                            </button>
                        </div>

                    </h4>
                </div>
                <div class="panel-collapse collapse ">
                    <div class="panel-body ">
                        <div class="col-sm-6 col-md-6 col-lg-9">


                            {% for n,va in v.items %}
                                <div class="form-group">
                                    {% if n == "ad_sources" %}
                                        <label><h3>广告ID</h3></label>
                                        <button type="button" class="btn btn-sm btn-primary add_ad_source "><i
                                                class="fa fa-plus">添加</i>
                                        </button>
                                        {% for ad_info in va %}
                                            <div class="panel panel-info">
                                                <div class="panel-heading ads_site_panel">
                                                    <h4 class="panel-title">

                                                        <label style="color: #0c0c0c">priority:</label><span
                                                            class="ad_source_t"
                                                            t="priority">{{ ad_info.priority }}</span>
                                                        <label style="color: #0c0c0c">name:</label><span
                                                            class="ad_source_t"
                                                            t="source_name">{{ ad_info.source_name }}</span>
                                                        <label style="color: #0c0c0c">id:</label><span
                                                            class="ad_source_t" t="ad_id">{{ ad_info.ad_id }}</span>
                                                        <label style="color: #0c0c0c">type:</label><span
                                                            class="ad_source_t" t="ad_type">{{ ad_info.ad_type }}</span>

                                                        <button type="button"
                                                                class="btn btn-success btn-sm show_info"
                                                                style="margin-left: 10px">编辑
                                                        </button>
                                                        <button type="button"
                                                                class="btn btn-danger btn-sm del_ads_source">删除
                                                        </button>
                                                    </h4>
                                                </div>

                                                <div class="panel-collapse collapse">
                                                    <div class="panel-body">
                                                        <div class="col-sm-6 col-md-6 col-lg-11 pull-right">
                                                            <!-- ad_source 内容-->

                                                            <div class="checkbox">
                                                                <label>
                                                                    <input type="checkbox" name="is_enable"
                                                                           class="cus_ad_source"
                                                                           {% if ad_info.is_enable %}checked="checked"{% endif %}>is_enable
                                                                </label>
                                                            </div>


                                                            <div class="form-group">
                                                                <label>source_name</label>
                                                                <select name="source_name" class=" cus_ad_source"
                                                                        title="source_name"
                                                                        data-actions-box="true">
                                                                    <option selected value="facebook"
                                                                            {% if ad_info.source_name == "facebook" %}selected{% endif %}>
                                                                        facebbok
                                                                    </option>
                                                                    <option selected value="admob"
                                                                            {% if ad_info.source_name == "admob" %}selected{% endif %}>
                                                                        admob
                                                                    </option>
                                                                </select>
                                                            </div>

                                                            <div class="form-group">
                                                                <label>priority</label>
                                                                <input name="priority"
                                                                       class="form-control cus_ad_source"
                                                                       placeholder="priority"
                                                                       value="{{ ad_info.priority }}">
                                                            </div>


                                                            <div class="form-group">
                                                                <label>ad_type</label>
                                                                <input name="ad_type" class="form-control cus_ad_source"
                                                                       placeholder="ad_type"
                                                                       value="{{ ad_info.ad_type }}">
                                                            </div>

                                                            <div class="form-group">
                                                                <label>ad_id</label>
                                                                <input name="ad_id" class="form-control cus_ad_source"
                                                                       placeholder="ad_id"
                                                                       value="{{ ad_info.ad_id }}">
                                                            </div>

                                                            <div class="form-group">
                                                                <label>expire_time</label>
                                                                <input name="expire_time"
                                                                       class="form-control cus_ad_source"
                                                                       placeholder="expire_time"
                                                                       value="{{ ad_info.expire_time }}">
                                                            </div>

                                                            <div class="form-group">
                                                                <label>skip_ad_time</label>
                                                                <input name="skip_ad_time"
                                                                       class="form-control cus_ad_source"
                                                                       placeholder="skip_ad_time"
                                                                       value="{{ ad_info.skip_ad_time }}">
                                                            </div>

                                                            <div class="form-group">
                                                                <label>style</label>
                                                                <input name="style" class="form-control cus_ad_source"
                                                                       placeholder="style"
                                                                       value="{{ ad_info.style }}">
                                                            </div>

                                                            <!-- ad_control 内容-->

                                                            <div class="form-group">
                                                                <label><h4>ad_control</h4></label>
                                                                <div class="btn-group btn-group-xs" role="group"
                                                                     style="margin-top: 5px;">
                                                                    <button type="button"
                                                                            class="btn btn-info ads-enable">enable
                                                                    </button>
                                                                    <button type="button"
                                                                            class="btn btn-danger ads-disable">
                                                                        disable
                                                                    </button>

                                                                </div>
                                                                <div class="{% if not ad_info.ad_control %}hidden {% endif %} cus_ad_control"
                                                                     style="margin-left: 80px">
                                                                    <div class="form-group">
                                                                        <label>skip_range</label>
                                                                        <input name="skip_range" class="form-control"
                                                                               placeholder="skip_range"
                                                                               value="{{ ad_info.ad_control.skip_range }}">
                                                                    </div>
                                                                    <div class="checkbox">
                                                                        <label>
                                                                            <input name="icon_enable"
                                                                                   type="checkbox"
                                                                                   {% if ad_info.ad_control.icon_enable %}checked="checked"{% endif %}>icon_enable
                                                                        </label>
                                                                    </div>

                                                                    <div class="checkbox">
                                                                        <label>
                                                                            <input name="title_enable"
                                                                                   type="checkbox"
                                                                                   {% if ad_info.ad_control.icon_enable %}checked="checked"{% endif %}>title_enable
                                                                        </label>
                                                                    </div>

                                                                    <div class="checkbox">
                                                                        <label>
                                                                            <input name="desc_enable"
                                                                                   type="checkbox"
                                                                                   {% if ad_info.ad_control.desc_enable %}checked="checked"{% endif %}>desc_enable
                                                                        </label>
                                                                    </div>

                                                                    <div class="checkbox">
                                                                        <label>
                                                                            <input name="img_enable" type="checkbox"
                                                                                   {% if ad_info.ad_control.img_enable %}checked="checked"{% endif %}>img_enable
                                                                        </label>
                                                                    </div>

                                                                    <div class="checkbox">
                                                                        <label>
                                                                            <input name="cta_enable" type="checkbox"
                                                                                   {% if ad_info.ad_control.cta_enable %}checked="checked"{% endif %}>cta_enable
                                                                        </label>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    {% else %}
                                        <label>{{ n }}</label>
                                        <input name="{{ n }}" class="form-control out_1" placeholder="{{ n }}"
                                               value="{{ va }}" }}>
                                    {% endif %}
                                </div>
                            {% endfor %}

                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}


    </div>

    <!-- 模态框（Modal） -->
    <div class="modal fade" id="s_ads_json" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel"></h4>
                </div>
                <div class="modal-body">
                    <textarea name="" id="json_ta" cols="30" rows="10"
                              style="margin: 0px;width: 100%;height: 700px;"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>

                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>
    <div class="cus_ss hidden">
        <option value="">----------</option>
        {% for i in ads_site %}
            <option value="{{ i }}">{{ i }}</option>
        {% endfor %}

    </div>
{% endblock %}


{% block extrabody %}
    <script type="text/javascript">


        //设置图表

        $(function () {
                //init_ad_site
                var int_field=['show_times_limit','click_times_limit','priority','expire_time','skip_ad_time','style']
                var float_field=['skip_range',]
                function init_ad_site() {
                    var panel_h = $('<div class="panel panel-default"></div>')
                    var p_h_h = $('<div class="panel-heading ads_site_panel"></div>')
                    var p_t_h = $('<h4 class="panel-title"></h4>')
                    p_t_h.append(init_ad_site_input())
                    p_h_h.append(p_t_h)
                    panel_h.append(p_h_h)
                    panel_h.append(init_panel_body())
                    return panel_h
                }

                function init_panel_body() {
                    var d = $('<div class="col-sm-6 col-md-6 col-lg-9"></div>')
                    //d.append($('<div class="form-group"><label>used_days</label> <input name="used_days" class="form-control out_1" placeholder="used_days"=""></div>'))
                    //d.append($('<div class="form-group"><label>interval_times</label> <input name="interval_times" class="form-control out_1" placeholder="interval_times"></div>'))
                    //d.append($('<div class="form-group"><label>interval_time</label> <input name="interval_time" class="form-control out_1" placeholder="interval_time"></div>'))
                    d.append($('<div class="form-group"><label>show_times_limit</label> <input name="show_times_limit" class="form-control out_1" placeholder="show_times_limit"></div>'))
                    d.append($('<div class="form-group"><label>click_times_limit</label> <input name="click_times_limit" class="form-control out_1" placeholder="click_times_limit"></div>'))
                    var ad_source_h = $('<div class="form-group"><label><h3>ad_sources</h3></label><button type="button" class="btn btn-sm btn-primary add_ad_source "><i class="fa fa-plus">添加</i></button><div>')
                    d.append(ad_source_h)
                    var panel_body = $('<div class="panel-body "></div>')
                    panel_body.append(d)
                    var panel_collapse = $('<div class="panel-collapse collapse" style="height: auto;"></div>')
                    panel_collapse.append(panel_body)
                    return panel_collapse

                }

                function init_ad_site_input() {
                    var input_g_h = $('<div class="input-group"><span class="input-group-addon">广告位置</span></div>')
                    var sel_h = $('<select name="ads_site_name" class="selectpicker" title="广告位" data-actions-box="true"><select/>')
                    var ads_site_ss = $(".cus_ss").children().clone()
                    sel_h.append(ads_site_ss)
                    var sed_ad_site_l = get_all_ads_se()
                    sel_h.children().each(function () {
                        if ($.inArray($(this).text(), sed_ad_site_l) >= 0) {
                            $(this).attr("disabled", "disabled")
                        } else {
                            $(this).removeAttr("disabled")
                        }
                    })
                    input_g_h.append(sel_h)
                    input_g_h.append($('<button type="button" class="btn btn-success show_info" style="margin-left: 10px">编辑该广告</button>'))
                    input_g_h.append($('<button type="button" class="btn btn-danger del_ads" style="margin-left: 10px">删除该广告</button>'))
                    input_g_h.append($('<button type="button" class="btn btn-info show_ads_json" style="margin-left: 10px">显示该广告位位置json</button>'))
                    sel_h.selectpicker({"width": 250,})
                    ads_init_block()
                    return input_g_h
                }

                // add ad site
                $("body").on("click", "button.top_add_ad_site", function () {
                    $("#accordion").prepend(init_ad_site())

                })


                //ad_source enable/disable
                $("body").on("click", "button.show_info", function () {
                    $(this).parents('.ads_site_panel').next('.panel-collapse').collapse('toggle')
                });
                //ad_control enable/disable
                $("body").on("click", "button.ads-enable", function () {
                    $(this).parent().next('div').removeClass('hidden')
                });

                $("body").on("click", "button.ads-disable", function () {
                    $(this).parent().next('div').addClass('hidden')
                });
                //提示框
                $("body").on("click", "button.del_ads", function () {
                    var result = confirm('是否删除！');
                    if (result) {
                        $(this).parents('.panel-default').remove()
                        alert('删除成功！')
                    }
                });

                $("body").on("click", "button.del_ads_source", function () {
                    var result = confirm('是否删除！');
                    if (result) {
                        $(this).parents('.panel-info').remove()
                        alert('删除成功！')
                    }
                });

                function get_ads_site(obj) {
                    return obj.find("select[name='ads_site_name']").val()

                }

                function add_to_list(v, arr) {
                    arr.push(v)
                    return arr

                }

                function add_to_dict(k, v, dic) {

                    if ($.inArray(k, int_field)>=0){
                        v = s_to_i(k,v)
                    }
                    if ($.inArray(k, float_field)>=0){
                        v= s_to_f(k,v)
                    }
                    if (v || typeof (v) === 'boolean') {
                        dic[k] = v
                    };

                    return dic
                }

                function get_items_json(obj, ad_site_name) {
                    var ret = {}
                    var item_json = {}

                    // out1
                    obj.next().find("[name].out_1").each(function () {
                        if ($(this).attr("type") === "checkbox") {
                            add_to_dict($(this).attr("name"), $(this).is(":checked"), item_json)
                        } else {
                            add_to_dict($(this).attr("name"), $(this).val(), item_json)
                        }

                    })

                    var ad_sources = []
                    //
                    obj.next().find('.panel-info').each(function () {
                        var i_info = {}
                        $(this).find("[name].cus_ad_source").each(function () {
                            if ($(this).attr("type") === "checkbox") {
                                add_to_dict($(this).attr("name"), $(this).is(":checked"), i_info)
                            } else {
                                add_to_dict($(this).attr("name"), $(this).val(), i_info)
                            }
                        })
                        var ad_control_dom = $(this).find('.cus_ad_control')
                        var ad_control = {}
                        if (!ad_control_dom.hasClass('hidden')) {
                            ad_control_dom.find("[name]").each(function () {
                                if ($(this).attr("type") === "checkbox") {
                                    add_to_dict($(this).attr("name"), $(this).is(":checked"), ad_control)
                                } else {
                                    add_to_dict($(this).attr("name"), $(this).val(), ad_control)
                                }
                            })
                        }
                        if (JSON.stringify(ad_control) !== "{}") {

                            add_to_dict("ad_control", ad_control, i_info)
                        }
                        ;
                        add_to_list(i_info, ad_sources)


                    })
                    item_json['ad_sources'] = ad_sources
                    ret[ad_site_name] = item_json
                    return ret

                }


                $("body").on("change", 'input[name="ad_id"]', function () {
                    $(this).parents('.panel-info').find("span[t=ad_id]").text($(this).val())

                })

                $("body").on("change", 'select[name="source_name"]', function () {
                    $(this).parents('.panel-info').find("span[t=source_name]").text($(this).val())

                })

                $("body").on("change", 'input[name="priority"]', function () {
                    $(this).parents('.panel-info').find("span[t=priority]").text($(this).val())

                })

                $("body").on("change", 'input[name="ad_type"]', function () {
                    $(this).parents('.panel-info').find("span[t=ad_type]").text($(this).val())

                })

                //显示json
                $("body").on("click", "button.show_ads_json", function () {
                    var obj = $(this).parents('.ads_site_panel')
                    var ad_site_name = get_ads_site(obj)
                    if (!ad_site_name) {
                        alert("未选择广告位置")
                        return
                    }
                    var json_data = get_items_json(obj, ad_site_name)
                    json_data = JSON.stringify(json_data, null, 2)
                    set_to_model(json_data, "广告位置:" + ad_site_name)

                });

                function set_to_model(json_data, title) {
                    $('#json_ta').text(json_data)
                    $('#myModalLabel').text(title)
                    $('#s_ads_json').modal("show")
                }

                function get_all_data() {
                    var f_ret = {}
                    var ret = {}
                    $('.ads_site_panel').each(function () {
                        var ad_site_name = get_ads_site($(this))
                        if (ad_site_name) {
                            var json_data = get_items_json($(this), ad_site_name)
                            add_to_dict(ad_site_name, json_data[ad_site_name], ret)
                        }

                    })
                    var all_show_t_l = $('#all_show_times_limit').val()
                    var all_click_t_l = $('#all_click_times_limit').val()
                    if (all_show_t_l === "" || all_show_t_l === null || all_show_t_l === undefined){
                        alert("all_show_times_limit 为空")
                        throw SyntaxError();
                    }
                    if (all_click_t_l === "" || all_click_t_l === null || all_click_t_l === undefined){
                        alert("all_click_times_limit 为空")
                        throw SyntaxError();
                    }
                    all_show_t_l = s_to_i("all_show_times_limit",all_show_t_l)
                    all_click_t_l = s_to_i("all_click_times_limit",all_click_t_l)

                    f_ret['all_show_times_limit'] = all_show_t_l
                    f_ret['all_click_times_limit'] = all_click_t_l
                    f_ret['content'] = ret
                    return f_ret
                }
                function s_to_i(t, d) {
                    var r = Number(d)
                    if (!r && r!==0) {
                        alert(t + "的值必须是数字")
                        throw SyntaxError();
                    }
                    return r
                }

                function s_to_f(t, d) {
                    console.log('kais'+t+d)
                    var r = parseFloat(d)
                    if (!r && r!==0) {
                        alert(t + "的值必须是浮点型")
                        throw SyntaxError();
                    }
                    return r
                }

                //显示所有json
                $("body").on("click", "button.top_show_json", function () {

                    var all_items = get_all_data()


                    set_to_model(JSON.stringify(all_items, null, 2), "总体json")
                });
                $("body").on("click", "button.save_json", function () {
                    var r_url = "{{ breadcrumbs.1.url }}"
                    var pkg_id = getQueryVariable("_p_pkg__id__exact")
                    var ctr_v = $("#country-select").val()
                    var min_v = $("#min_v").val()
                    var max_v = $("#max_v").val()
                    var is_a = $("#is_active").is(":checked")
                    console.log(is_a)
                    var ret = get_all_data()

                    var req_d = {"ctr_v": ctr_v, 'min_v': min_v, "max_v": max_v, "ret": ret, "is_a": is_a,"pkg_id":pkg_id}

                    if (!ctr_v || !min_v || !max_v) {
                        alert('参数缺失 !')
                        return
                    }
                    var user = {{ admin_view.user.id }}
                        $.ajax({
                            url: '/ads/add/',
                            contentType: "application/json;charset=utf-8",
                            type: "post",
                            dataType: "json",
                            data: JSON.stringify(req_d),
                            beforeSend: function (xhr, settings) {
                                xhr.setRequestHeader("X-CSRFToken", $.getCookie('csrftoken'))
                            },
                            complete: function () {

                            },
                            success: function (data) {
                                if (data.code < 0) {
                                    alert(data.msg)
                                }
                                if (data.code === 0) {
                                    window.location.href = r_url
                                }

                            }
                        });

                })


                //广告位不能选择一样的
                function get_all_ads_se() {
                    //获取当前所有被选择的广告位置
                    var ads_site_se_li = []

                    $("select[name='ads_site_name']").each(function () {
                        ads_site_se_li.push($(this).val())
                    })

                    return ads_site_se_li
                };

                function ads_init_block() {
                    //让广告位置互斥
                    var ads_site_se_li = get_all_ads_se()

                    $("select[name='ads_site_name']").each(function () {
                        var se_val = $(this).val()
                        $(this).children().each(function () {
                            if ($(this).text() != se_val && $.inArray($(this).text(), ads_site_se_li) >= 0) {
                                $(this).attr("disabled", "disabled")
                            } else {
                                $(this).removeAttr("disabled")
                            }
                        })
                        $(this).selectpicker('refresh');

                    })
                };

                $("body").on("change", "select[name='ads_site_name']", function () {
                    ads_init_block()
                });

                // 初始化 ad_source
                function get_checkbox(name) {
                    return $('<div class="checkbox"><label><input type="checkbox" name="' + name + '"class="cus_ad_source" >' + name + '</label></div>')

                }

                function get_input(name) {
                    $('<div class="form-group"> <label>' + name + '</label><input name="' + name + '" class="form-control cus_ad_source" placeholder="' + name + '"></div>')
                }

                function init_ad_source_html() {
                    var s_html = '<div class="panel panel-info">\n                                                <div class="panel-heading ads_site_panel">\n                                                    <h4 class="panel-title">\n\n                                                        <label style="color: #0c0c0c">priority:</label><span class="ad_source_t" t="priority"></span>\n                                                        <label style="color: #0c0c0c">name:</label><span class="ad_source_t" t="source_name">admob</span>\n                                                        <label style="color: #0c0c0c">id:</label><span class="ad_source_t" t="ad_id"></span>\n                                                        <label style="color: #0c0c0c">type:</label><span class="ad_source_t" t="ad_type"></span>\n\n                                                        <button type="button" class="btn btn-success btn-sm show_info" style="margin-left: 10px">编辑\n                                                        </button>\n                                                        <button type="button" class="btn btn-danger btn-sm del_ads_source">删除\n                                                        </button>\n                                                    </h4>\n                                                </div>\n\n                                                <div class="panel-collapse collapse" style="height: 0px;">\n                                                    <div class="panel-body">\n                                                        <div class="col-sm-6 col-md-6 col-lg-11 pull-right">\n                                                            <!-- ad_source 内容-->\n\n                                                            <div class="checkbox">\n                                                                <label>\n                                                                    <input type="checkbox" name="is_enable" class="cus_ad_source" checked="checked">is_enable\n                                                                </label>\n                                                            </div>\n\n\n                                                            <div class="form-group">\n                                                                <label>source_name</label>\n                                                                <select name="source_name" class=" cus_ad_source" title="source_name" data-actions-box="true">\n                                                                    <option selected="" value="facebook">\n                                                                        facebbok\n                                                                    </option>\n                                                                    <option selected="" value="admob">\n                                                                        admob\n                                                                    </option>\n                                                                </select>\n                                                            </div>\n\n                                                            <div class="form-group">\n                                                                <label>priority</label>\n                                                                <input name="priority" class="form-control cus_ad_source" placeholder="priority" value="4">\n                                                            </div>\n\n\n                                                            <div class="form-group">\n                                                                <label>ad_type</label>\n                                                                <input name="ad_type" class="form-control cus_ad_source" placeholder="ad_type" value="123">\n                                                            </div>\n\n                                                            <div class="form-group">\n                                                                <label>ad_id</label>\n                                                                <input name="ad_id" class="form-control cus_ad_source" placeholder="ad_id" value="ca-apps-pub-7068043263440714/4819201662">\n                                                            </div>\n\n                                                            <div class="form-group">\n                                                                <label>expire_time</label>\n                                                                <input name="expire_time" class="form-control cus_ad_source" placeholder="expire_time" value="1">\n                                                            </div>\n\n\n                                                            <!-- ad_control 内容-->\n\n                                                            <div class="form-group">\n                                                                <label><h4>ad_control</h4></label>\n                                                                <div class="btn-group btn-group-xs" role="group" style="margin-top: 5px;">\n                                                                    <button type="button" class="btn btn-info ads-enable">enable\n                                                                    </button>\n                                                                    <button type="button" class="btn btn-danger ads-disable">\n                                                                        disable\n                                                                    </button>\n\n                                                                </div>\n                                                                <div class=" cus_ad_control" style="margin-left: 80px">\n                                                                    <div class="form-group">\n                                                                        <label>skip_ad_time</label>\n                                                                        <input name="skip_ad_time" class="form-control cus_ad_source" placeholder="skip_ad_time" value="1">\n                                                                    </div>\n\n                                                                    <div class="form-group">\n                                                                        <label>style</label>\n                                                                        <input name="style" class="form-control cus_ad_source" placeholder="style" value="2">\n                                                                    </div>\n                                                                    <div class="form-group">\n                                                                        <label>skip_range</label>\n                                                                        <input name="skip_range" class="form-control" placeholder="skip_range" value="3">\n                                                                    </div>\n                                                                    <div class="checkbox">\n                                                                        <label>\n                                                                            <input name="icon_enable" type="checkbox" checked="checked">icon_enable\n                                                                        </label>\n                                                                    </div>\n\n                                                                    <div class="checkbox">\n                                                                        <label>\n                                                                            <input name="title_enable" type="checkbox" checked="checked">title_enable\n                                                                        </label>\n                                                                    </div>\n\n                                                                    <div class="checkbox">\n                                                                        <label>\n                                                                            <input name="desc_enable" type="checkbox" checked="checked">desc_enable\n                                                                        </label>\n                                                                    </div>\n\n                                                                    <div class="checkbox">\n                                                                        <label>\n                                                                            <input name="img_enable" type="checkbox" checked="checked">img_enable\n                                                                        </label>\n                                                                    </div>\n\n                                                                    <div class="checkbox">\n                                                                        <label>\n                                                                            <input name="cta_enable" type="checkbox" checked="checked">cta_enable\n                                                                        </label>\n                                                                    </div>\n\n                                                                    <div class="checkbox">\n                                                                        <label>\n                                                                            <input name="skip_ads" type="checkbox" checked="checked">skip_ads\n                                                                        </label>\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </div>'

                    return s_html
                }

                function getQueryVariable(variable) {
                    var query = window.location.search.substring(1);
                    var vars = query.split("&");
                    for (var i = 0; i < vars.length; i++) {
                        var pair = vars[i].split("=");
                        if (pair[0] === variable) {
                            return pair[1];
                        }
                    }
                    return (false);
                }

                //---------------------------
                // add ad source
                $("body").on("click", "button.add_ad_source", function () {
                    $(this).after(init_ad_source_html())
                })


                $('#collapseOne').on('show.bs.collapse', function () {
                    {#console.log(this.parent().children('.glyphicon'))#}
                })


                $(".selectpicker").selectpicker({
                    "width": 250,
                });
                ads_init_block()
                $('#ver-value').tagsinput({"width": "80px"});


            }
        );


    </script>
    <script type="text/javascript" src="/static/xadmin/vendor/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
    <script src="/static/xadmin/dist/echarts.min.js"></script>
    <script type="text/javascript" charset="utf8"
            src="/static/xadmin/vendor/DataTables-1.10.20/js/jquery.dataTables.js"></script>
    <script src="/static/xadmin/vendor/bootstrap-select/js/bootstrap-select.js"></script>
    <script src="/static/xadmin/vendor/jQuery-tags-input/bootstrap-tagsinput.js"></script>
    <script type="text/javascript" src="/static/xadmin/vendor/datatables.net/js/jquery.dataTables.js"></script>
    <script type="text/javascript" src="/static/xadmin/vendor/datatables.net-buttons/js/dataTables.buttons.js"></script>
    <script type="text/javascript" src="/static/xadmin/vendor/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script type="text/javascript"
            src="/static/xadmin/vendor/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>
{% endblock %}

{% block extrahead %}
    <link href="/static/xadmin/vendor/bootstrap-datepicker/css/datepicker.css" type="text/css" media="screen"
          rel="stylesheet">
    <link href="/static/xadmin/css/xadmin.main.css" type="text/css" media="screen" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/static/xadmin/vendor/DataTables-1.10.20/css/jquery.dataTables.css">
    <link href="/static/xadmin/vendor/bootstrap-select/css/bootstrap-select.min.css" rel="stylesheet"/>
    <link href="/static/xadmin/vendor/jQuery-tags-input/bootstrap-tagsinput.css" rel="stylesheet"/>
{% endblock %}